name: Build HERA Runtime

on:
  workflow_dispatch:

jobs:
  build:
    name: Build on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup MATLAB
        uses: matlab-actions/setup-matlab@v2
        with:
          release: 'R2024b' # Adjust to your target MATLAB version
          products: |
            Statistics_and_Machine_Learning_Toolbox
            Parallel_Computing_Toolbox
            MATLAB_Compiler

      - name: Run Unit Tests
        uses: matlab-actions/run-command@v2
        with:
          command: run('tests/run_tests.m')

      - name: Build HERA Runtime
        uses: matlab-actions/run-command@v2
        with:
          command: |
            addpath('deploy');
            build_hera();

      - name: Archive Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: HERA_Installer_${{ matrix.os }}
          path: deploy/output/
